- hosts: sandbox
  gather_facts: no
  tasks:
    - name: "Start test container"
      delegate_to: localhost
      docker_container:
        name: "{{ inventory_hostname }}"
        image: "{{ docker_image }}"
        command: sleep 30m
        state: started
        recreate: yes
        cleanup: yes
        detach: true
        interactive: true
        tty: true

    - name: Install python and sudo inside the container
      raw: apt -y update && apt install -y python3-minimal python3-urllib3 sudo

- name: "Import {{ playbook }} playbook"
  import_playbook: "{{ playbook }}"

- name: "Idempotency check of {{ playbook }} playbook"
  import_playbook: "{{ playbook }}"

- hosts: sandbox
  tasks:
    - name: "Stop {{ inventory_hostname }} container"
      delegate_to: localhost
      docker_container:
        name: "{{ inventory_hostname }}"
        state: absent
